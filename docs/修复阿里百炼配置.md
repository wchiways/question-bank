# ⚠️ 重要：阿里百炼配置问题已修复

## 问题原因

您遇到了 `AI提供商 ali_bailian 未配置或未启用` 的警告，这是因为：

在 `config.json` 中：
- `default_provider` 设置为 `"ali_bailian"`
- 但 `ali_bailian.enabled` 设置为 `false`

## ✅ 解决方案

### 方法1：启用阿里百炼（推荐）

编辑 `config.json`，将 `ali_bailian` 的 `enabled` 改为 `true`：

```json
{
  "ai": {
    "default_provider": "ali_bailian",
    "providers": {
      "ali_bailian": {
        "enabled": true,  // ← 改为 true
        "api_key": "sk-f78636946c144a1793bf4f948171c1bc"
      }
    }
  }
}
```

**然后重启服务器**：
```bash
# 按 Ctrl+C 停止服务器
./scripts/dev.sh  # 重新启动
```

### 方法2：使用硅基流动（默认）

如果不想用阿里百炼，可以改回硅基流动：

```json
{
  "ai": {
    "default_provider": "siliconflow",  // ← 改回 siliconflow
    "providers": {
      "siliconflow": {
        "enabled": true,
        "api_key": "你的硅基流动API密钥"
      }
    }
  }
}
```

## 🔍 配置说明

### enabled 字段的作用

`enabled: false` - 表示该提供商被禁用，即使配置了API密钥也不会使用  
`enabled: true` - 表示该提供商启用，可以使用

### default_provider 的作用

`default_provider` 指定默认使用的AI提供商。  
**注意**：指定的提供商必须同时满足：
1. 存在于 `providers` 中
2. `enabled` 为 `true`
3. `api_key` 已配置

否则会降级使用 Mock 提供商（返回模拟答案）

## ✅ 验证配置

启动服务器后，查看日志：

**正确的日志**：
```
✅ AI服务已初始化: 阿里百炼
```

**错误的日志**（当前情况）：
```
⚠️  AI提供商 ali_bailian 未配置或未启用，使用Mock提供商
🧪 使用Mock AI提供商（仅用于测试）
```

## 📝 完整配置示例

### 使用阿里百炼

```json
{
  "ai": {
    "default_provider": "ali_bailian",
    "providers": {
      "ali_bailian": {
        "enabled": true,
        "api_key": "sk-你的API密钥",
        "model": "qwen-plus-latest"
      }
    }
  }
}
```

### 使用硅基流动

```json
{
  "ai": {
    "default_provider": "siliconflow",
    "providers": {
      "siliconflow": {
        "enabled": true,
        "api_key": "sk-你的API密钥",
        "model": "Qwen/QwQ-32B"
      }
    }
  }
}
```

## 🚀 快速修复步骤

1. 编辑配置文件
   ```bash
   nano config.json
   ```

2. 找到 `ali_bailian` 部分，将 `"enabled": false` 改为 `"enabled": true`

3. 保存并退出（Ctrl+X, Y, Enter）

4. 重启服务器
   ```bash
   # 在服务器运行的终端按 Ctrl+C 停止
   ./scripts/dev.sh  # 重新启动
   ```

5. 测试查询
   - 在OCS中查询问题
   - 应该不再返回 "这是模拟的AI答案"

## 💡 提示

- **API密钥安全**：不要将包含真实API密钥的 config.json 提交到Git
- **获取API密钥**：https://bailian.console.aliyun.com/
- **查看日志**：`tail -f logs/app.log` 可以看到详细的调用日志

---

> 修复后，OCS将能够正常调用阿里百炼API获取真实答案！
